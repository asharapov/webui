<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" type="text/css" href="http://localhost:8000/ext-3.2.0/resources/css/ext-all.css"/>
  <script type="text/javascript" src="http://localhost:8000/ext-3.2.0/adapter/ext/ext-base.js"></script>
  <script type="text/javascript" src="http://localhost:8000/ext-3.2.0/ext-all-debug.js"></script>
  <script type="text/javascript" src="http://localhost:8000/ext-3.2.0/src/locale/ext-lang-ru.js"></script>
</head>
<body>

<script type="text/javascript">
Ext.BLANK_IMAGE_URL="http://localhost:8000/ext-3.2.0/resources/images/default/s.gif";
Ext.onReady( function() {
  Ext.QuickTips.init();

  Ext.ns("Ext.ux.wui.plugins");
  Ext.ux.wui.plugins.FormPanel = Ext.extend(Ext.util.Observable, {
      init: function(formPanel) {
          formPanel.on("render", this.onRender);
      },
      onRender: function(fp) {
          var formEl = fp.getForm().el.dom;
          var funct = formEl.submit;
          formEl.submit = function() {
              for (var n in fp.baseParams) {
                  if (!fp.get(n)) {
                      fp.add({xtype:"hidden", itemId:n, name:n, value:fp.baseParams[n]});
                  }
              }
              if (!fp.get("__VIEWSTATE")) {
                  fp.add({xtype:"hidden", itemId:"__VIEWSTATE", name:"__VIEWSTATE", value:"WUI.env.state"});
              }
              fp.doLayout();
              funct.apply(formEl);
          };
      }
  });
  Ext.preg("Ext.ux.wui.plugins.FormPanel", Ext.ux.wui.plugins.FormPanel);
  Ext.ux.wui.plugins.Field = Ext.extend(Ext.util.Observable, {
      init: function(field) {
          if (field.initialConfig.activeError) {
              field.on("render", function() {
                  this.markInvalid(this.initialConfig.activeError);
              })
          }
      }
  });
  Ext.preg("Ext.ux.wui.plugins.Field", Ext.ux.wui.plugins.Field);

  var root = new Ext.Viewport({
    layout: "auto",
    items: [ {
        xtype: "form",
        title: "form panel",
        width: 500,
        height: 400,
        url: "/webui/ext/widgets/formpanel.html",
        method: "GET",
        baseParams: {a: "A", b:"B"},
        waitTitle: "Please, wait that fucking form...",
        standardSubmit: true,
        items: [ {
            xtype: "box",
            fieldLabel: "Box",
            html: "text in the box"
          },{
            xtype: "displayfield",
            fieldLabel: "Display",
            value: "text in the displayField"
          },{
            id: "txt1",
            xtype: "textfield",
            name: "txt1",
            fieldLabel: "Text field",
            emptyText: "enter a value",
            maxLength: 10,
            msgTarget: "under",
            activeError: "Some shit happens",
            html: "some shit may be here",
            plugins: ["Ext.ux.wui.plugins.Field"]
          }, {
            xtype: "field",
            name: "file1",
            fieldLabel: "File",
            inputType:  "text",
            disabled: false
          }, {
            xtype: "trigger",
            fieldLabel: "trigger"
          },{
            xtype: "datefield",
            format: "d.m.Y",
            readOnly: false,
            disabledDays: [0,6],
            value: new Date(), //"20.0x2.2009",
            fieldLabel: "date"
          },{
            xtype: "textarea",
            fieldLabel: "area",
            //width: 125,
            grow: true,
            growMax:300
          },{
            id: "num1",
            xtype: "numberfield",
            name: "num1",
            fieldLabel: "Numeric field (0..10)",
            invalidText: "invalid text",
            vtypeText: "vtype text",
            msgTarget: "under",
            minValue: 0,
            maxValue: 10,
            value: 1,
            activeError: "Advanced test error",
          plugins: ["Ext.ux.wui.plugins.Field"]
          }
        ],
        monitorValid: true,
        monitorPoll: 2000,
        fbar: {
          xtype: "toolbar",
          frame: false,
          items: [ {
              xtype:"button",
              text:"submit",
              formBind:true,
              handler:function(b,e){
                var fp = b.ownerCt.ownerCt;
                var f = fp.getForm();
                console.log("*** before f.submit()");
                f.submit();
                console.log("*** after f.submit()");
                /*
                f.submit({
                  success: function(form, action) {
                    console.log("success: ", action);
                    alert("success");
                  },
                  failure: function(form, action) {
                    console.log("failure: ", action);
                    alert("failure");
                  }
                });
                */
              }
            },
            {xtype:"button", text:"reset", handler:function(){this.ownerCt.ownerCt.getForm().reset();}},
          ]
        },
        frame: true,
        border: true,
        html: "text on the panel",
        plugins: ["Ext.ux.wui.plugins.FormPanel"],
        listeners: {
          "xclientvalidation" : function(frm, dirty) {console.log("clientvalidation", arguments);},
          "render" : function(){console.log("render 1")}.createSequence(function(){console.log("render 2")})
        }
      }]
    });
});
</script>

</body>
</html>
