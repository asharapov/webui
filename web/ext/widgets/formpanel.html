<html>
<head>
  <link rel="stylesheet" type="text/css" href="http://localhost:8000/ext-3.2.0/resources/css/ext-all.css"/>
  <script type="text/javascript" src="http://localhost:8000/ext-3.2.0/adapter/ext/ext-base.js"></script>
  <script type="text/javascript" src="http://localhost:8000/ext-3.2.0/ext-all-debug.js"></script>
</head>
<body>

<script type="text/javascript">
Ext.BLANK_IMAGE_URL="http://localhost:8000/ext-3.2.0/resources/images/default/s.gif";
Ext.onReady( function() {
  Ext.QuickTips.init();

  Ext.ns("Ext.ux.plugins");
  Ext.ux.plugins.FormSubmissionPlugin = Ext.extend(Ext.util.Observable, {
    init: function(formPanel) {
      formPanel.on("render", this.onRender);
    },
    onRender: function(fp) {
      var formEl = fp.getForm().el.dom;
      var funct = formEl.submit;
      formEl.submit = function() {
        for (var n in fp.baseParams) {
          if (!fp.get(n)) {
            fp.add( {xtype:"hidden", itemId:n, name:n, value:fp.baseParams[n]} );
          }
        }
        if (!fp.get("__VIEWSTATE")) {
          fp.add( {xtype:"hidden", itemId:"__VIEWSTATE", name:"__VIEWSTATE", value:"xyz"} );
        }
        fp.doLayout();
        funct.apply(formEl);
      };
    }
  });
  Ext.preg("fsp", Ext.ux.plugins.FormSubmissionPlugin);
  Ext.ux.plugins.FormFieldPlugin = Ext.extend(Ext.util.Observable, {
    init: function(field) {
      console.log("plugin fired  ", field);
      if (field.initialConfig.activeError) {
        field.on("render", function(){this.markInvalid(this.initialConfig.activeError);})
      }
    }
  });
  Ext.preg("ffp", Ext.ux.plugins.FormFieldPlugin);

  var root = new Ext.Viewport({
    layout: "auto",
    items: [ {
        xtype: "form",
        title: "form panel",
        width: 500,
        height: 300,
        url: "/webui/ext/widgets/formpanel.html",
        method: "GET",
        baseParams: {a: "A", b:"B"},
        waitTitle: "Please, wait that fucking form...",
        standardSubmit: true,
        items: [ {
            id: "txt1",
            xtype: "textfield",
            name: "txt1",
            fieldLabel: "Text field",
            emptyText: "enter a value",
            activeError: "Some shit happens",
            html: "some shit may be here",
            plugins: ["ffp"]
          }, {
            xtype: "textfield",
            name: "file1",
            fieldLabel: "File",
            inputType: "text",
            disabled: true
          }, {
            id: "num1",
            xtype: "numberfield",
            name: "num1",
            fieldLabel: "Numeric field (0..10)",
            invalidText: "invalid text",
            vtypeText: "vtype text",
            msgTarget: "under",
            minValue: 0,
            maxValue: 10,
            activeError: "Advanced test error",
            plugins: ["ffp"]
          }
        ],
        monitorValid: true,
        monitorPoll: 2000,
        fbar: {
          xtype: "toolbar",
          frame: false,
          items: [ {
              xtype:"button",
              text:"submit",
              formBind:true,
              handler:function(b,e){
                var fp = b.ownerCt.ownerCt;
                var f = fp.getForm();
                console.log("*** before f.submit()");
                f.submit();
                console.log("*** after f.submit()");
                /*
                f.submit({
                  success: function(form, action) {
                    console.log("success: ", action);
                    alert("success");
                  },
                  failure: function(form, action) {
                    console.log("failure: ", action);
                    alert("failure");
                  }
                });
                */
              }
            },
            {xtype:"button", text:"reset", handler:function(){this.ownerCt.ownerCt.getForm().reset();}},
          ]
        },
        frame: true,
        border: true,
        html: "text on the panel",
        plugins: "fsp",
        listeners: {
          "xclientvalidation" : function(frm, dirty) {console.log("clientvalidation", arguments);},
          "render" : function(){console.log("render 1")}.createSequence(function(){console.log("render 2")})
        }
      }]
    });
});
</script>

</body>
</html>
